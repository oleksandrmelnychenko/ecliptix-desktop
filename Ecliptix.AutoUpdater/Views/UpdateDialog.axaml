<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Ecliptix.AutoUpdater.ViewModels"
        x:Class="Ecliptix.AutoUpdater.Views.UpdateDialog"
        x:DataType="vm:UpdateViewModel"
        Title="Software Update"
        Width="600"
        Height="500"
        MinWidth="500"
        MinHeight="400"
        WindowStartupLocation="CenterOwner"
        CanResize="True"
        Icon="/Assets/update-icon.png">

    <Design.DataContext>
        <vm:UpdateViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Header -->
        <Border Grid.Row="0"
                Background="#2196F3"
                Padding="24,20">
            <StackPanel Spacing="8">
                <TextBlock Text="Update Available"
                          FontSize="24"
                          FontWeight="Bold"
                          Foreground="White"
                          IsVisible="{Binding !IsCriticalUpdate}"/>

                <TextBlock Text="Critical Update Required"
                          FontSize="24"
                          FontWeight="Bold"
                          Foreground="#FFE5A3"
                          IsVisible="{Binding IsCriticalUpdate}"/>

                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0"
                              Text="Current Version:"
                              Foreground="White"
                              Opacity="0.9"
                              Margin="0,0,8,0"/>
                    <TextBlock Grid.Column="1"
                              Text="{Binding CurrentVersion}"
                              Foreground="White"
                              FontWeight="SemiBold"/>
                </Grid>

                <Grid ColumnDefinitions="Auto,*">
                    <TextBlock Grid.Column="0"
                              Text="New Version:"
                              Foreground="White"
                              Opacity="0.9"
                              Margin="0,0,8,0"/>
                    <TextBlock Grid.Column="1"
                              Text="{Binding LatestVersion}"
                              Foreground="White"
                              FontWeight="Bold"
                              FontSize="16"/>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" Padding="24">
            <StackPanel Spacing="16">

                <!-- Release Notes -->
                <TextBlock Text="What's New"
                          FontSize="18"
                          FontWeight="SemiBold"
                          Margin="0,0,0,8"/>

                <Border Background="#F5F5F5"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="16">
                    <SelectableTextBlock Text="{Binding ReleaseNotes}"
                                        TextWrapping="Wrap"/>
                </Border>

                <!-- Critical Update Warning -->
                <Border Background="#FFF3E0"
                        BorderBrush="#FFB74D"
                        BorderThickness="2"
                        CornerRadius="4"
                        Padding="12"
                        IsVisible="{Binding IsCriticalUpdate}">
                    <StackPanel Spacing="8">
                        <TextBlock Text="⚠️ This is a critical security update"
                                  FontWeight="Bold"
                                  Foreground="#E65100"/>
                        <TextBlock Text="This update contains important security fixes. We strongly recommend installing it immediately."
                                  TextWrapping="Wrap"
                                  Foreground="#E65100"/>
                    </StackPanel>
                </Border>

                <!-- Download Progress -->
                <StackPanel Spacing="8" IsVisible="{Binding IsDownloading}">
                    <TextBlock Text="{Binding StatusMessage}"
                              FontWeight="SemiBold"/>
                    <ProgressBar Value="{Binding DownloadProgress}"
                                Height="8"
                                CornerRadius="4"/>
                    <TextBlock HorizontalAlignment="Right"
                              FontSize="12"
                              Foreground="#666">
                        <Run Text="{Binding DownloadProgress}"/>
                        <Run Text="%"/>
                    </TextBlock>
                </StackPanel>

                <!-- Error Message -->
                <Border Background="#FFEBEE"
                        BorderBrush="#F44336"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12"
                        IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <StackPanel Spacing="4">
                        <TextBlock Text="❌ Error"
                                  FontWeight="Bold"
                                  Foreground="#C62828"/>
                        <TextBlock Text="{Binding ErrorMessage}"
                                  TextWrapping="Wrap"
                                  Foreground="#C62828"/>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer Actions -->
        <Border Grid.Row="2"
                Background="#F5F5F5"
                BorderBrush="#E0E0E0"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <Grid ColumnDefinitions="*,Auto,Auto">

                <!-- Status on left -->
                <TextBlock Grid.Column="0"
                          Text="{Binding StatusMessage}"
                          VerticalAlignment="Center"
                          Foreground="#666"
                          IsVisible="{Binding !IsDownloading}"/>

                <!-- Buttons on right -->
                <Button Grid.Column="1"
                       Content="Install Update"
                       Command="{Binding InstallUpdateCommand}"
                       IsEnabled="{Binding !IsDownloading}"
                       Width="140"
                       Height="36"
                       Margin="0,0,12,0"
                       Classes="accent"/>

                <Button Grid.Column="2"
                       Content="Later"
                       Command="{Binding DismissUpdateCommand}"
                       IsEnabled="{Binding !IsCriticalUpdate}"
                       Width="100"
                       Height="36"/>

            </Grid>
        </Border>

    </Grid>

</Window>
