<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:comp="clr-namespace:Ecliptix.Core.Views.Memberships.Components"
        xmlns:sharedConverters="clr-namespace:Ecliptix.Core.Shared.Converters"
        xmlns:coreControls="clr-namespace:Ecliptix.Core.Controls.Core"
        xmlns:core="clr-namespace:Ecliptix.Core.Core.Controls"
        xmlns:memberships1="clr-namespace:Ecliptix.Core.Features.Authentication.ViewModels.Hosts"
        xmlns:bottomSheetModal="clr-namespace:Ecliptix.Core.Controls.Modals.BottomSheetModal"
        mc:Ignorable="d"
        d:DesignWidth="480"
        d:DesignHeight="680"
        SystemDecorations="None"
        ExtendClientAreaToDecorationsHint="False"
        x:DataType="memberships1:MembershipHostWindowModel"
        Width="480"
        Height="720"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="True"
        Background="Transparent"
        Title=""
        Icon="avares://Ecliptix.Core/Assets/Branding/Logos/logo_256x256.png"
        TransparencyLevelHint="Transparent"
        x:Class="Ecliptix.Core.Features.Authentication.Views.Hosts.MembershipHostWindow">

    <Window.Resources>
        <sharedConverters:BooleanToOpacityConverter x:Key="BoolToOpacityConverter"
                                               TrueOpacity="1.0"
                                               FalseOpacity="0" />
    </Window.Resources>

    <Grid x:Name="MainContentGrid" ClipToBounds="True">
        <Border Classes="animated-background"
                Background="{StaticResource BlurBackgroundBrush}"
                CornerRadius="{StaticResource WindowBorderRadius}"
                Margin="12">
            <Border.Effect>
                <BlurEffect Radius="{StaticResource BackgroundBlurRadius}" />
            </Border.Effect>
        </Border>
        
        <comp:TitleBar
            VerticalAlignment="Top"
            ZIndex="5"
            DisableMinimizeButton="False"
            DisableCloseButton="False"
            Margin="8" />
        
        <Grid 
            x:Name="GeneralConrolsGrid"
            ZIndex="10">
            
            <Button HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Command="{Binding NavigateBack}"
                    Margin="24,64,0,0"
                    ZIndex="2"
                    Classes="back-button"
                    Opacity="{Binding CanNavigateBack, Converter={StaticResource BoolToOpacityConverter}}">

                <Image Source="avares://Ecliptix.Core/Assets/Icons/UI/back-icon.png"
                       Stretch="Uniform"
                       Width="18"
                       Height="18" />
            </Button>

            <Border Name="LanguageSelectorContainer"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="16"
                    ZIndex="12"
                    Background="Transparent" />

            <coreControls:NetworkStatusNotification
                x:Name="NetworkNotification"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,50,0,0"
                FontSize="12"
                Width="320"
                Height="70"
                ZIndex="1001"
                DataContext="{Binding NetworkStatusNotification}" />

        </Grid>
        
        <Border
            Margin="8"
            CornerRadius="12"
            ClipToBounds="True"
            ZIndex="15"
            x:Name="BottomSheetContainer">
            <bottomSheetModal:BottomSheetControl
                x:Name="BottomSheetControl"
                ZIndex="111"
                VerticalAlignment="Stretch"
                HorizontalAlignment="Stretch"
                MinHeight="200"
                MaxHeight="600"
                DismissableScrimColor="DarkGray"
                UnDismissableScrimColor="Black"
                IsDismissableOnScrimClick="True"
            />
        </Border>
      
        
        <!-- Main Content Border -->
        <Border Classes="main-border"
                Margin="8"
                x:Name="MainBorder">

            <Border.Effect>
                <DropShadowEffect Color="{StaticResource ShadowColor}"
                                  BlurRadius="{StaticResource ShadowBlurRadius}"
                                  Opacity="0.4"
                                  OffsetX="0"
                                  OffsetY="2" />
            </Border.Effect>

            <!-- Main Content Grid -->
            <Grid RowDefinitions="Auto,*,Auto"
                  RowSpacing="{StaticResource HeaderSpacing}"
                  ClipToBounds="True">

                <!-- TODO testing margin because of moved titlebar ?-->
                <!-- Logo Section -->
                <Border Grid.Row="0"
                        HorizontalAlignment="Center"
                        Padding="{StaticResource HeaderPadding}"
                        Margin="0 63 0 0">
                    <Svg Path="../../../../Assets/Branding/Logos/ecliptix_logo.svg"
                         Width="{StaticResource Logo.Size}"
                         Height="{StaticResource Logo.Size}"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Top" />
                </Border>

                <!-- Content Area -->
                <Border Grid.Row="1"
                        Padding="{StaticResource ContentPadding}">
                    <core:ModuleContentControl ViewModelContent="{Binding CurrentView}"
                                               Background="Transparent"
                                               Width="{StaticResource Content.MaxWidth}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Stretch"
                                               ClipToBounds="False" />
                </Border>

                <!-- Footer Section -->
                <StackPanel Grid.Row="2"
                            Classes="footer-section">

                    <!-- Legal Links -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Spacing="{StaticResource Spacing.L}">

                        <Button Content="{Binding LocalizationService[Footer.PrivacyPolicy]}"
                                Command="{Binding OpenPrivacyPolicyCommand}"
                                Classes="footer-link" />

                        <TextBlock Text="•"
                                   Classes="footer"
                                   VerticalAlignment="Center" />

                        <Button Content="{Binding LocalizationService[Footer.TermsOfService]}"
                                Command="{Binding OpenTermsOfServiceCommand}"
                                Classes="footer-link" />

                        <TextBlock Text="•"
                                   Classes="footer"
                                   VerticalAlignment="Center" />

                        <Button Content="{Binding LocalizationService[Footer.Support]}"
                                Command="{Binding OpenSupportCommand}"
                                Classes="footer-link" />
                    </StackPanel>

                    <!-- Copyright Text -->
                    <TextBlock Text="{Binding LocalizationService[Footer.AgreementText]}"
                               Classes="footer"
                               TextWrapping="Wrap"
                               MaxWidth="280" />

                    <Grid ColumnDefinitions="*">
                        <TextBlock Text="{Binding AppVersion, StringFormat='v{0}'}"
                                   Classes="version"
                                   HorizontalAlignment="Left"
                                   VerticalAlignment="Bottom"
                                   Grid.Column="0"
                                   ZIndex="5"
                                   ToolTip.Tip="{Binding FullVersionInfo}" />
                        <TextBlock Text="{Binding LocalizationService[Footer.Copyright]}"
                                   Classes="footer"
                                   Opacity="0.7" 
                                   Grid.Column="0"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding BuildInfo, StringFormat='Build {0}'}"
                                   Classes="version"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Bottom"
                                   Grid.Column="0"
                                   ZIndex="5"
                                   ToolTip.Tip="{Binding FullVersionInfo}" />
                    </Grid>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>