<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Ecliptix.Core.Features.Chats.ViewModels"
             xmlns:components="clr-namespace:Ecliptix.Core.Features.Chats.Views.Components"
             mc:Ignorable="d"
             d:DesignWidth="800"
             d:DesignHeight="600"
             x:DataType="vm:ChatWindowViewModel"
             x:Class="Ecliptix.Core.Features.Chats.Views.Components.ChatWindowPanel">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceInclude Source="/Assets/Icons/Chat/CallIcon.axaml" />
                <ResourceInclude Source="/Assets/Icons/Chat/VideoIcon.axaml" />
                <ResourceInclude Source="/Assets/Icons/Chat/InfoIcon.axaml" />
                <ResourceInclude Source="/Assets/Icons/Chat/AttachIcon.axaml" />
                <ResourceInclude Source="/Assets/Icons/Chat/EmojiIcon.axaml" />
                <ResourceInclude Source="/Assets/Icons/Chat/MicrophoneIcon.axaml" />
                <ResourceInclude Source="/Assets/Icons/Chat/SendIcon.axaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Border Background="#F6F7F9"
            BorderThickness="0"
            CornerRadius="0">
        <Grid RowDefinitions="60,*,80">
            <!-- Header -->
            <Border Grid.Row="0"
                    Background="#FFFFFF"
                    BorderBrush="#E0E0E0"
                    BorderThickness="0,0,0,1"
                    Padding="16">
                <Grid>
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          IsVisible="{Binding SelectedConversation, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <!-- Avatar & Name -->
                        <StackPanel Grid.Column="0"
                                    Orientation="Horizontal"
                                    Spacing="12">
                            <Border Width="40"
                                    Height="40"
                                    CornerRadius="20"
                                    Background="#FF7A00">
                                <Grid>
                                    <TextBlock Text="{Binding SelectedConversation.ContactAvatar}"
                                               FontSize="16"
                                               FontWeight="Bold"
                                               Foreground="#FFFFFF"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center" />

                                    <!-- Online indicator -->
                                    <Border Width="10"
                                            Height="10"
                                            CornerRadius="5"
                                            Background="#4CAF50"
                                            BorderBrush="#FFFFFF"
                                            BorderThickness="2"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Bottom"
                                            Margin="0,0,-2,-2"
                                            IsVisible="{Binding SelectedConversation.IsOnline}" />
                                </Grid>
                            </Border>

                            <StackPanel VerticalAlignment="Center"
                                        Spacing="2">
                                <TextBlock Text="{Binding SelectedConversation.ContactName}"
                                           FontSize="15"
                                           FontWeight="SemiBold"
                                           Foreground="#000000" />
                                <TextBlock Text="Online"
                                           FontSize="12"
                                           Foreground="#4CAF50"
                                           IsVisible="{Binding SelectedConversation.IsOnline}" />
                                <TextBlock Text="Typing..."
                                           FontSize="12"
                                           Foreground="#FF7A00"
                                           IsVisible="{Binding SelectedConversation.IsTyping}" />
                            </StackPanel>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="2"
                                    Orientation="Horizontal"
                                    Spacing="8">
                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Width="40"
                                    Height="40"
                                    CornerRadius="20"
                                    Command="{Binding StartCallCommand}"
                                    ToolTip.Tip="Voice Call">
                                <PathIcon Data="{StaticResource CallIconData}"
                                          Width="20"
                                          Height="20"
                                          Foreground="#666666" />
                            </Button>

                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Width="40"
                                    Height="40"
                                    CornerRadius="20"
                                    Command="{Binding StartVideoCallCommand}"
                                    ToolTip.Tip="Video Call">
                                <PathIcon Data="{StaticResource VideoIconData}"
                                          Width="20"
                                          Height="20"
                                          Foreground="#666666" />
                            </Button>

                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Width="40"
                                    Height="40"
                                    CornerRadius="20"
                                    Command="{Binding ShowInfoCommand}"
                                    ToolTip.Tip="Contact Info">
                                <PathIcon Data="{StaticResource InfoIconData}"
                                          Width="20"
                                          Height="20"
                                          Foreground="#666666" />
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- Empty state when no conversation selected -->
                    <TextBlock Text="Select a conversation to start chatting"
                               FontSize="14"
                               Foreground="#999999"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               IsVisible="{Binding SelectedConversation, Converter={x:Static ObjectConverters.IsNull}}" />
                </Grid>
            </Border>

            <!-- Messages Area -->
            <ScrollViewer Grid.Row="1"
                          Name="MessagesScroll"
                          VerticalScrollBarVisibility="Auto"
                          Padding="16">
                <ItemsControl ItemsSource="{Binding Messages}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <components:MessageBubble DataContext="{Binding}" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Input Area -->
            <Border Grid.Row="2"
                    Background="#FFFFFF"
                    BorderBrush="#E0E0E0"
                    BorderThickness="0,1,0,0"
                    Padding="16"
                    IsVisible="{Binding SelectedConversation, Converter={x:Static ObjectConverters.IsNotNull}}">
                <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                    <!-- Attach Button -->
                    <Button Grid.Column="0"
                            Background="Transparent"
                            BorderThickness="0"
                            Width="40"
                            Height="40"
                            CornerRadius="20"
                            Command="{Binding AttachFileCommand}"
                            ToolTip.Tip="Attach File"
                            Margin="0,0,8,0">
                        <PathIcon Data="{StaticResource AttachIconData}"
                                  Width="20"
                                  Height="20"
                                  Foreground="#666666" />
                    </Button>

                    <!-- Text Input -->
                    <Border Grid.Column="1"
                            Background="#F6F7F9"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="20"
                            Padding="12,8">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0"
                                     Text="{Binding MessageText}"
                                     Watermark="Type a message..."
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="#000000"
                                     VerticalAlignment="Center" />

                            <Button Grid.Column="1"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Width="32"
                                    Height="32"
                                    CornerRadius="16"
                                    Command="{Binding ToggleEmojiCommand}"
                                    ToolTip.Tip="Emoji">
                                <PathIcon Data="{StaticResource EmojiIconData}"
                                          Width="18"
                                          Height="18"
                                          Foreground="#666666" />
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Voice Button -->
                    <Button Grid.Column="2"
                            Background="Transparent"
                            BorderThickness="0"
                            Width="40"
                            Height="40"
                            CornerRadius="20"
                            Command="{Binding StartVoiceRecordingCommand}"
                            ToolTip.Tip="Voice Message"
                            Margin="8,0">
                        <PathIcon Data="{StaticResource MicrophoneIconData}"
                                  Width="20"
                                  Height="20"
                                  Foreground="#666666" />
                    </Button>

                    <!-- Send Button -->
                    <Button Grid.Column="3"
                            Background="#FF7A00"
                            BorderThickness="0"
                            Width="40"
                            Height="40"
                            CornerRadius="20"
                            Command="{Binding SendMessageCommand}"
                            ToolTip.Tip="Send">
                        <PathIcon Data="{StaticResource SendIconData}"
                                  Width="18"
                                  Height="18"
                                  Foreground="#FFFFFF" />
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Border>
</UserControl>
